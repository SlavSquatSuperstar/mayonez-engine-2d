buildscript {
    project.ext.kotlinVersion = '1.7.0'
}

plugins {
    id 'com.github.johnrengelman.shadow' version '7.1.2' // For making fat jars

    id 'org.jetbrains.kotlin.jvm' version "$kotlinVersion"
    id 'org.jetbrains.dokka' version '1.6.21' // For Kotlin documentation

    id 'java'
    id 'application'
}

// Project Info

group 'slavsquatsuperstar'
version '0.7.4-SNAPSHOT-2'
description = 'The root project for Mayonez Engine that contains all modules'

allprojects {
    group 'slavsquatsuperstar'
    version '0.7.4-pre2'
}

// Custom Settings
project.ext {
    javaVersion = '17'
    junitVersion = '5.8.2'
    // TODO separate into GL/AWT modules
    mainClass = 'slavsquatsuperstar.demos.GLRendererTest'
//    mainClass = 'slavsquatsuperstar.demos.geometrydash.LevelEditor'
    mainModule = 'mayonez.demos'
}
sourceCompatibility = javaVersion

// Dependencies

allprojects {
    repositories {
        mavenCentral()
    }
}

dependencies {
    // Subprojects
    implementation project(':mayonez-base')
    implementation project(':mayonez-demos')
}

// Tasks and Plugins

application { // For 'run' task
    mainClass = project.ext.mainClass
    mainModule = project.ext.mainModule
}

run {
    jvmArgs = ["-XstartOnFirstThread"] // For LWJGL
}

jar {
    manifest.attributes('Main-Class': project.ext.mainClass)
    // 'Class-Path': configurations.runtimeClasspath.files.collect { it.getName() }.join(' ')
}

shadowJar {
    dependsOn jar
    archiveClassifier.set('')
    manifest.from jar.manifest
    exclude 'META-INF/*.txt', // Extraneous readme and license files
            'META-INF/*.SF',
            'META-INF/*.DSA',
            'META-INF/*.RSA',
            'META-INF/*.LIST'
}